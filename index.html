<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout Logger">
    <title>Workout Logger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid #333;
        }

        .header h1 {
            color: #4a90e2;
            font-size: 1.8rem;
        }

        .theme-toggle {
            background: #4a90e2;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .session-status {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }

        .session-status.inactive {
            border-left-color: #e74c3c;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .current-session {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .current-session.active {
            display: block;
        }

        .exercise-in-session {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid #4a90e2;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .exercise-name {
            font-weight: bold;
            color: #4a90e2;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #cccccc;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2a2a2a;
            color: #ffffff;
            font-size: 16px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .sets-container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .set-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: #333;
            border-radius: 8px;
            align-items: center;
        }

        .set-item input {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 5px;
            background: #1a1a1a;
            color: #ffffff;
            text-align: center;
        }

        .remove-set {
            background: #e74c3c;
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        .btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 10px 0;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #357abd;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .session-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .workout-history {
            margin-top: 40px;
        }

        .workout-item {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #4a90e2;
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .workout-date {
            font-weight: bold;
            color: #4a90e2;
        }

        .muscle-group {
            background: #4a90e2;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .exercise-details {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444;
        }

        .exercise-summary {
            margin-bottom: 15px;
        }

        .set-details {
            font-size: 0.9rem;
            color: #cccccc;
            margin-top: 5px;
        }

        .data-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .light-theme {
            background: #ffffff;
            color: #333333;
        }

        .light-theme .form-group input,
        .light-theme .form-group select,
        .light-theme .form-group textarea {
            background: #f5f5f5;
            color: #333333;
            border-color: #ddd;
        }

        .light-theme .sets-container,
        .light-theme .workout-item,
        .light-theme .session-status,
        .light-theme .current-session {
            background: #f8f9fa;
        }

        .light-theme .set-item,
        .light-theme .exercise-in-session {
            background: #e9ecef;
        }

        .light-theme .set-item input {
            background: #ffffff;
            color: #333333;
            border-color: #ddd;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .set-item {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            .data-management {
                grid-template-columns: 1fr;
            }

            .session-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Workout Logger</h1>
            <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è / üåô</button>
        </div>

        <div class="session-status" id="sessionStatus">
            <div class="session-header">
                <span><strong>Workout Session:</strong> <span id="sessionState">Not Started</span></span>
                <span id="sessionDate"></span>
            </div>
            <div id="sessionMuscleGroup" style="display: none;">
                <strong>Muscle Group:</strong> <span id="currentMuscleGroup"></span>
            </div>
        </div>

        <div class="session-controls">
            <button class="btn btn-success" id="startSessionBtn" onclick="startSession()">üèãÔ∏è Start Workout</button>
            <button class="btn btn-danger" id="endSessionBtn" onclick="endSession()" style="display: none;">‚úÖ End Workout</button>
        </div>

        <div class="current-session" id="currentSessionDiv">
            <h3>Current Session Exercises</h3>
            <div id="sessionExercises"></div>
        </div>

        <div class="workout-form" id="exerciseForm" style="display: none;">
            <h2>Add Exercise</h2>
            
            <div class="form-group">
                <label for="workoutDate">Date</label>
                <input type="date" id="workoutDate">
            </div>

            <div class="form-group">
                <label for="muscleGroup">Muscle Group</label>
                <select id="muscleGroup">
                    <option value="">-- Select Muscle Group --</option>
                    <option value="Biceps">Biceps</option>
                    <option value="Triceps">Triceps</option>
                    <option value="Shoulders">Shoulders</option>
                    <option value="Chest">Chest</option>
                    <option value="Back">Back</option>
                    <option value="Traps">Traps</option>
                    <option value="Legs">Legs</option>
                    <option value="Abs">Abs</option>
                    <option value="Glutes">Glutes</option>
                    <option value="Full Body">Full Body</option>
                </select>
            </div>

            <div class="form-group">
                <label for="exerciseName">Exercise Name</label>
                <input type="text" id="exerciseName" placeholder="e.g., Bench Press, Barbell Rows">
            </div>

            <div class="form-group">
                <label for="equipment">Equipment Used</label>
                <input type="text" id="equipment" placeholder="e.g., Barbell, Dumbbells">
            </div>

            <div class="form-group">
                <label for="notes">Notes (optional)</label>
                <textarea id="notes" placeholder="Any additional notes..."></textarea>
            </div>

            <div class="sets-container">
                <h3>Sets</h3>
                <div id="setsContainer">
                    <!-- Sets will be added here -->
                </div>
                <button class="btn" onclick="addSet()">‚ûï Add Set</button>
            </div>

            <button class="btn btn-success" onclick="addExerciseToSession()">‚úÖ Add Exercise to Session</button>
        </div>

        <div class="data-management">
            <button class="btn" onclick="exportData()">üì§ Export CSV</button>
            <button class="btn" onclick="importData()">üì• Import CSV</button>
            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear Data</button>
            <input type="file" id="fileInput" accept=".csv" style="display: none;" onchange="handleFileImport(event)">
        </div>

        <div class="workout-history">
            <h2>Workout History</h2>
            <div id="historyContainer">
                <p style="text-align: center; color: #888; margin: 40px 0;">
                    No workouts logged yet. Start your first workout session!
                </p>
            </div>
        </div>
    </div>

    <script>
        let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
        let currentSession = null;
        let currentSets = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('workoutDate').valueAsDate = new Date();
            displayHistory();
            addSet(); // Start with one set
            updateSessionStatus();
        });

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
        }

        function startSession() {
            const date = document.getElementById('workoutDate').value;
            if (!date) {
                alert('Please select a date for your workout');
                return;
            }

            currentSession = {
                date: date,
                exercises: [],
                timestamp: new Date().getTime()
            };

            document.getElementById('startSessionBtn').style.display = 'none';
            document.getElementById('endSessionBtn').style.display = 'block';
            document.getElementById('exerciseForm').style.display = 'block';
            document.getElementById('currentSessionDiv').classList.add('active');
            
            updateSessionStatus();
        }

        function endSession() {
            if (!currentSession || currentSession.exercises.length === 0) {
                alert('Please add at least one exercise to your workout session');
                return;
            }

            // Save the workout session
            workouts.push(currentSession);
            localStorage.setItem('workouts', JSON.stringify(workouts));

            // Reset session
            currentSession = null;
            document.getElementById('startSessionBtn').style.display = 'block';
            document.getElementById('endSessionBtn').style.display = 'none';
            document.getElementById('exerciseForm').style.display = 'none';
            document.getElementById('currentSessionDiv').classList.remove('active');
            
            // Clear form
            clearExerciseForm();
            
            updateSessionStatus();
            displayHistory();
            displayCurrentSession();
            
            alert('Workout session completed and saved!');
        }

        function updateSessionStatus() {
            const statusDiv = document.getElementById('sessionStatus');
            const stateSpan = document.getElementById('sessionState');
            const dateSpan = document.getElementById('sessionDate');
            const muscleGroupDiv = document.getElementById('sessionMuscleGroup');
            const muscleGroupSpan = document.getElementById('currentMuscleGroup');

            if (currentSession) {
                statusDiv.classList.remove('inactive');
                stateSpan.textContent = 'In Progress';
                dateSpan.textContent = currentSession.date;
                
                if (currentSession.exercises.length > 0) {
                    const muscleGroup = currentSession.exercises[0].muscleGroup;
                    muscleGroupDiv.style.display = 'block';
                    muscleGroupSpan.textContent = muscleGroup;
                    
                    // Lock muscle group selection
                    document.getElementById('muscleGroup').value = muscleGroup;
                    document.getElementById('muscleGroup').disabled = true;
                }
            } else {
                statusDiv.classList.add('inactive');
                stateSpan.textContent = 'Not Started';
                dateSpan.textContent = '';
                muscleGroupDiv.style.display = 'none';
                document.getElementById('muscleGroup').disabled = false;
            }
        }

        function displayCurrentSession() {
            const container = document.getElementById('sessionExercises');
            
            if (!currentSession || currentSession.exercises.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center;">No exercises added yet</p>';
                return;
            }

            container.innerHTML = currentSession.exercises.map((exercise, index) => `
                <div class="exercise-in-session">
                    <div class="exercise-header">
                        <span class="exercise-name">${exercise.exerciseName}</span>
                        <button class="btn btn-danger" style="width: auto; padding: 5px 10px; margin: 0;" onclick="removeExerciseFromSession(${index})">Remove</button>
                    </div>
                    <div>
                        <strong>Equipment:</strong> ${exercise.equipment || 'None'}
                    </div>
                    <div>
                        <strong>Sets:</strong> ${exercise.sets.length} sets
                        ${exercise.sets.map(set => 
                            `<br>Set ${set.setNumber}: ${set.reps} reps √ó ${set.weight}${set.weight > 0 ? 'lbs' : ''} (${set.rest}s rest)`
                        ).join('')}
                    </div>
                    ${exercise.notes ? `<div><strong>Notes:</strong> ${exercise.notes}</div>` : ''}
                </div>
            `).join('');
        }

        function removeExerciseFromSession(index) {
            if (confirm('Remove this exercise from the current session?')) {
                currentSession.exercises.splice(index, 1);
                displayCurrentSession();
                
                // If no exercises left, unlock muscle group
                if (currentSession.exercises.length === 0) {
                    document.getElementById('muscleGroup').disabled = false;
                    document.getElementById('muscleGroup').value = '';
                }
                
                updateSessionStatus();
            }
        }

        function addSet() {
            const setNumber = currentSets.length + 1;
            const setDiv = document.createElement('div');
            setDiv.className = 'set-item';
            setDiv.innerHTML = `
                <input type="number" placeholder="Reps" min="0" data-type="reps">
                <input type="number" placeholder="Weight" min="0" step="0.5" data-type="weight">
                <input type="number" placeholder="Rest (sec)" min="0" data-type="rest">
                <button class="remove-set" onclick="removeSet(this)">√ó</button>
            `;
            document.getElementById('setsContainer').appendChild(setDiv);
            currentSets.push({reps: '', weight: '', rest: ''});
        }

        function removeSet(button) {
            if (currentSets.length > 1) {
                button.parentElement.remove();
                currentSets.pop();
            }
        }

        function addExerciseToSession() {
            if (!currentSession) {
                alert('Please start a workout session first');
                return;
            }

            const muscleGroup = document.getElementById('muscleGroup').value;
            const exerciseName = document.getElementById('exerciseName').value;
            const equipment = document.getElementById('equipment').value;
            const notes = document.getElementById('notes').value;

            if (!muscleGroup || !exerciseName) {
                alert('Please fill in Muscle Group and Exercise Name');
                return;
            }

            // Check if this is the first exercise - if so, lock muscle group
            if (currentSession.exercises.length > 0) {
                const sessionMuscleGroup = currentSession.exercises[0].muscleGroup;
                if (muscleGroup !== sessionMuscleGroup) {
                    alert(`This session is for ${sessionMuscleGroup}. Please select ${sessionMuscleGroup} or end this session to start a new one.`);
                    return;
                }
            }

            // Collect set data
            const setInputs = document.querySelectorAll('.set-item');
            const sets = [];
            
            setInputs.forEach((setDiv, index) => {
                const reps = setDiv.querySelector('[data-type="reps"]').value;
                const weight = setDiv.querySelector('[data-type="weight"]').value;
                const rest = setDiv.querySelector('[data-type="rest"]').value;
                
                if (reps) {
                    sets.push({
                        setNumber: index + 1,
                        reps: reps || '0',
                        weight: weight || '0',
                        rest: rest || '0'
                    });
                }
            });

            if (sets.length === 0) {
                alert('Please add at least one set with reps');
                return;
            }

            // Add exercise to current session
            const exercise = {
                muscleGroup,
                exerciseName,
                equipment,
                notes,
                sets
            };

            currentSession.exercises.push(exercise);
            
            // Clear form
            clearExerciseForm();
            
            displayCurrentSession();
            updateSessionStatus();
            
            alert('Exercise added to session!');
        }

        function clearExerciseForm() {
            document.getElementById('exerciseName').value = '';
            document.getElementById('equipment').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('setsContainer').innerHTML = '';
            currentSets = [];
            addSet();
        }

        function displayHistory() {
            const container = document.getElementById('historyContainer');
            
            if (workouts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; margin: 40px 0;">No workouts logged yet. Start your first workout session!</p>';
                return;
            }

            // Sort workouts: by muscle group of first exercise, then by date descending
            const sortedWorkouts = [...workouts].sort((a, b) => {
                const aMuscleGroup = a.exercises[0]?.muscleGroup || '';
                const bMuscleGroup = b.exercises[0]?.muscleGroup || '';
                
                if (aMuscleGroup !== bMuscleGroup) {
                    return aMuscleGroup.localeCompare(bMuscleGroup);
                }
                return new Date(b.date) - new Date(a.date);
            });

            container.innerHTML = sortedWorkouts.map(workout => `
                <div class="workout-item">
                    <div class="workout-header">
                        <span class="workout-date">${workout.date}</span>
                        <span class="muscle-group">${workout.exercises[0]?.muscleGroup || 'Mixed'}</span>
                    </div>
                    <div class="exercise-details">
                        <strong>Workout Session (${workout.exercises.length} exercises)</strong>
                        ${workout.exercises.map(exercise => `
                            <div class="exercise-summary">
                                <strong>${exercise.exerciseName}</strong>
                                ${exercise.equipment ? ` - ${exercise.equipment}` : ''}
                                ${exercise.notes ? `<br><em>${exercise.notes}</em>` : ''}
                                <div class="set-details">
                                    ${exercise.sets.map(set => 
                                        `Set ${set.setNumber}: ${set.reps} reps √ó ${set.weight}${set.weight > 0 ? 'lbs' : ''} (${set.rest}s rest)`
                                    ).join('<br>')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function exportData() {
            if (workouts.length === 0) {
                alert('No workout data to export');
                return;
            }

            // Sort workouts by muscle group, then by date descending
            const sortedWorkouts = [...workouts].sort((a, b) => {
                const aMuscleGroup = a.exercises[0]?.muscleGroup || '';
                const bMuscleGroup = b.exercises[0]?.muscleGroup || '';
                
                if (aMuscleGroup !== bMuscleGroup) {
                    return aMuscleGroup.localeCompare(bMuscleGroup);
                }
                return new Date(b.date) - new Date(a.date);
            });

            const csvHeader = 'Muscle Group,Date,Exercise Name,Equipment,Set #,Reps,Weight,Rest Time,Notes\n';
            const csvData = sortedWorkouts.map(workout => 
                workout.exercises.map(exercise =>
                    exercise.sets.map(set => 
                        `${exercise.muscleGroup},${workout.date},${exercise.exerciseName},"${exercise.equipment}",${set.setNumber},${set.reps},${set.weight},${set.rest},"${exercise.notes}"`
                    ).join('\n')
                ).join('\n')
            ).join('\n');

            const csv = csvHeader + csvData;
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `workout_data_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            window.URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const importedWorkouts = {};
                    
                    // Skip header row
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const data = parseCSVLine(lines[i]);
                            if (data.length >= 9) {
                                const [muscleGroup, date, exerciseName, equipment, setNum, reps, weight, rest, notes] = data;
                                
                                const workoutKey = `${date}_${muscleGroup}`;
                                
                                if (!importedWorkouts[workoutKey]) {
                                    importedWorkouts[workoutKey] = {
                                        date,
                                        exercises: [],
                                        timestamp: new Date().getTime()
                                    };
                                }
                                
                                let exercise = importedWorkouts[workoutKey].exercises.find(e => e.exerciseName === exerciseName);
                                
                                if (!exercise) {
                                    exercise = {
                                        muscleGroup,
                                        exerciseName,
                                        equipment: equipment.replace(/"/g, ''),
                                        notes: notes.replace(/"/g, ''),
                                        sets: []
                                    };
                                    importedWorkouts[workoutKey].exercises.push(exercise);
                                }
                                
                                exercise.sets.push({
                                    setNumber: parseInt(setNum),
                                    reps: reps,
                                    weight: weight,
                                    rest: rest
                                });
                            }
                        }
                    }
                    
                    const importedArray = Object.values(importedWorkouts);
                    workouts = workouts.concat(importedArray);
                    localStorage.setItem('workouts', JSON.stringify(workouts));
                    displayHistory();
                    alert(`Successfully imported ${importedArray.length} workout sessions!`);
                } catch (error) {
                    alert('Error importing file. Please check the CSV format.');
                }
            };
            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all workout data? This cannot be undone.')) {
                workouts = [];
                currentSession = null;
                localStorage.setItem('workouts', JSON.stringify(workouts));
                displayHistory();
                updateSessionStatus();
                document.getElementById('startSessionBtn').style.display = 'block';
                document.getElementById('endSessionBtn').style.display = 'none';
                document.getElementById('exerciseForm').style.display = 'none';
                document.getElementById('currentSessionDiv').classList.remove('active');
                alert('All data cleared successfully!');
            }
        }

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
        }
    </script>
</body>
</html>
